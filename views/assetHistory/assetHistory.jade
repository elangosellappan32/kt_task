extends ../layout

block content
  .container-fluid.px-4
    .d-flex.justify-content-between.align-items-center.mb-4
      h1.mb-0= asset ? `${asset.name} History` : 'Asset History'
      a.btn.btn-secondary(href='/assets')
        i.fas.fa-arrow-left.me-2
        | Back to Assets
    
    // Check if we're showing a single asset's history or the asset list
    if asset && assignments && timeline
      // Single Asset History View
      .row
        .col-md-4
          // Asset Details Card
          .card.mb-4
            .card-header
              h5.mb-0 Asset Details
            .card-body
              p
                strong Name: 
                | #{asset.name}
              p
                strong Tag: 
                | #{asset.asset_tag || 'N/A'}
              p
                strong Category: 
                | #{asset.Category ? asset.Category.name : 'Uncategorized'}
              p
                strong Status: 
                span.badge.bg-primary #{asset.status}
        
        .col-md-8
          // Timeline Card
          .card.mb-4
            .card-header
              h5.mb-0 Asset Timeline
            .card-body
              // Timeline will be rendered here
              each event in timeline
                .timeline-item.mb-3
                  .d-flex
                    .flex-shrink-0.me-3
                      i.fas.fa-circle.text-success
                    div
                      h6.mb-1= event.title
                      p.mb-1= event.description
                      small.text-muted= new Date(event.date).toLocaleDateString()
    else
      // Asset Selection Table Section
      .card
        .card-header
          h5.mb-0 Select Asset for History
        .card-body
          .table-responsive
            table#assetsTable.table.table-striped.table-hover
              thead
                tr
                  th Asset Name
                  th Asset Tag
                  th Category
                  th Serial Number
                  th Status
                  th Actions
              tbody
                // Loop through each asset
                each asset in assets || []
                  tr=
                    td= asset.name
                    td= asset.asset_tag || 'N/A'
                    td= asset.Category ? asset.Category.name : 'Uncategorized'
                    td= asset.serial_number || 'N/A'
                    td
                      span.badge.rounded-pill(class={
                        'bg-success': asset.status === 'available',
                        'bg-primary': asset.status === 'assigned',
                        'bg-warning': asset.status === 'under_maintenance',
                        'bg-secondary': asset.status === 'retired'
                      })= asset.status.split('_').map(word => word.charAt(0).toUpperCase() + word.slice(1)).join(' ')
                    // Actions column with history view button
                    td
                      a.btn.btn-sm.btn-outline-primary(href=`/asset-history/${asset.id}`)
                        i.fas.fa-history.me-2
                        | View History

//js for interactive 
block scripts
  script.
    document.addEventListener('DOMContentLoaded', function() {
      // Initialize DataTable 
      $('#assetsTable').DataTable({
        pageLength: 25
      });
    });
